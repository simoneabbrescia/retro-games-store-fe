<div class="register-shell">
  <mat-card class="register-card" appearance="outlined">
    <mat-card-header>
      <div mat-card-avatar class="register-avatar">
        <mat-icon>person_add</mat-icon>
      </div>
      <mat-card-title>Registrati</mat-card-title>
      <mat-card-subtitle>Crea il tuo account RetroGames Store</mat-card-subtitle>
    </mat-card-header>

    <mat-divider></mat-divider>

    <mat-card-content>
      <!-- Alert globali -->
      <div class="alert error" *ngIf="errorMsg">
        <mat-icon>error_outline</mat-icon>
        <span>{{ errorMsg }}</span>
      </div>
      <div class="alert success" *ngIf="successMsg">
        <mat-icon>check_circle</mat-icon>
        <span>{{ successMsg }}</span>
      </div>

      <!-- Stepper -->
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
        <mat-stepper linear>
          <!-- STEP 1: Dati personali + Indirizzo -->
          <mat-step [stepControl]="registerForm.get('personal')!" label="Dati personali e indirizzo">
            <div formGroupName="personal" class="form-grid">
              <div class="row col-2">
                <mat-form-field appearance="outline">
                  <mat-label>Nome</mat-label>
                  <input matInput formControlName="nome" required />
                  <mat-error
                    *ngIf="registerForm.get('personal.nome')?.invalid && registerForm.get('personal.nome')?.touched">
                    Inserisci il nome
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Cognome</mat-label>
                  <input matInput formControlName="cognome" required />
                  <mat-error
                    *ngIf="registerForm.get('personal.cognome')?.invalid && registerForm.get('personal.cognome')?.touched">
                    Inserisci il cognome
                  </mat-error>
                </mat-form-field>
              </div>

              <mat-form-field appearance="outline" class="full">
                <mat-label>Via</mat-label>
                <input matInput formControlName="via" required />
                <mat-error
                  *ngIf="registerForm.get('personal.via')?.invalid && registerForm.get('personal.via')?.touched">
                  Inserisci l’indirizzo
                </mat-error>
              </mat-form-field>

              <div class="row col-3">
                <mat-form-field appearance="outline">
                  <mat-label>Città</mat-label>
                  <input matInput formControlName="citta" required />
                  <mat-error
                    *ngIf="registerForm.get('personal.citta')?.invalid && registerForm.get('personal.citta')?.touched">
                    Inserisci la città
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>CAP</mat-label>
                  <input matInput formControlName="cap" inputmode="numeric" required />
                  <mat-error
                    *ngIf="registerForm.get('personal.cap')?.invalid && registerForm.get('personal.cap')?.touched">
                    Inserisci un CAP valido
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Nazione</mat-label>
                  <input matInput formControlName="nazione" required />
                  <mat-error
                    *ngIf="registerForm.get('personal.nazione')?.invalid && registerForm.get('personal.nazione')?.touched">
                    Inserisci la nazione
                  </mat-error>
                </mat-form-field>
              </div>
            </div>

            <div class="step-actions">
              <button mat-flat-button color="primary" matStepperNext [disabled]="registerForm.get('personal')?.invalid">
                Continua
              </button>
            </div>
          </mat-step>

          <!-- STEP 2: Credenziali -->
          <mat-step [stepControl]="registerForm.get('credentials')!" label="Credenziali">
            <div formGroupName="credentials" class="form-grid">
              <mat-form-field appearance="outline" class="full">
                <mat-label>Email</mat-label>
                <mat-icon matPrefix>mail</mat-icon>
                <input matInput type="email" formControlName="email" autocomplete="email" required />
                <mat-error
                  *ngIf="registerForm.get('credentials.email')?.invalid && registerForm.get('credentials.email')?.touched">
                  Inserisci un’email valida
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full">
                <mat-label>Password</mat-label>
                <mat-icon matPrefix>lock</mat-icon>
                <input matInput [type]="'password'" formControlName="password" autocomplete="new-password" required />
                <mat-hint align="end">Minimo 8 caratteri</mat-hint>
                <mat-error
                  *ngIf="registerForm.get('credentials.password')?.invalid && registerForm.get('credentials.password')?.touched">
                  Inserisci una password valida
                </mat-error>
              </mat-form-field>
            </div>

            <div class="step-actions">
              <button mat-stroked-button color="primary" matStepperPrevious>Indietro</button>
              <button mat-flat-button color="primary" type="submit" [disabled]="registerForm.invalid">
                Crea account
              </button>
            </div>
          </mat-step>
        </mat-stepper>
      </form>
    </mat-card-content>

    <mat-card-actions align="end" class="card-actions">
      <span class="hint">Hai già un account?</span>
      <a class="link" [routerLink]="'/accedi'">Accedi</a>
    </mat-card-actions>
  </mat-card>
</div>

<app-footer></app-footer>